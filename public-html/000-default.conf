<VirtualHost *:80>
    ServerName datacenter.ucol.mx
    ServerAdmin webmaster@localhost

    # =========================
    #         ALIASES
    # =========================
    Alias /laralite/api /var/www/laralite/laralite/
    Alias /simple-laralite /var/www/simplesaml/public
    Alias /simple-localhost /var/www/simplesaml/public
    Alias /laralite /var/www/laralite/front
    

    # =========================
    #       FRONTEND (SPA)
    # =========================
    DocumentRoot /var/www/html

    <Directory /var/www/laralite/front>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # =========================
    #       laralite API
    # =========================
    <Directory /var/www/laralite/laralite>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php
        
        # Bloquear archivos sensibles por extensión
        <FilesMatch "\.(env|json|xml|yml|yaml|log|lock|md)$">
            Require all denied
        </FilesMatch>
        
        # Bloquear archivos específicos - Método individual más confiable
        <Files "cli.php">
            Require all denied
        </Files>
        
        <Files "artisan">
            Require all denied
        </Files>
        
        <Files "artisano">
            Require all denied
        </Files>
        
        <Files "composer.json">
            Require all denied
        </Files>
        
        <Files "composer.lock">
            Require all denied
        </Files>
        
        <Files "package.json">
            Require all denied
        </Files>
        
        <Files "package-lock.json">
            Require all denied
        </Files>
        
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule ^(.*)$ index.php?path=$1 [QSA,L]
        </IfModule>
    </Directory>

    # =========================
    #       SimpleSAML
    # =========================
    # Restringe acceso a toda la carpeta de SimpleSAML excepto /public
    <Directory /var/www/simplesaml>
        Require all denied
    </Directory>

    <Directory /var/www/simplesaml/public>
        Require all granted
    </Directory>
    
    # =========================
    #       CONFIGURACIÓN GLOBAL
    # =========================

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>